<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Portal de Imigração - Status do Cliente</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
		<script>
			tailwind.config = {
				theme: {
					extend: {
						colors: {
							brand: "#B8001C",
						},
					},
				},
			};
		</script>
		<style>
			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(10px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}
			.fade-in {
				animation: fadeIn 0.3s ease-out;
			}
			.progress-bar {
				transition: width 0.5s ease;
			}
			.section-card {
				animation: fadeIn 0.3s ease;
			}
		</style>
	</head>
	<body class="bg-gray-50">
		<!-- Login Screen -->
		<div
			id="loginScreen"
			class="min-h-screen bg-gradient-to-br from-red-50 to-rose-100 flex items-center justify-center p-4">
			<div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 fade-in">
				<div class="text-center mb-8">
					<div
						class="inline-flex items-center justify-center w-16 h-16 bg-brand rounded-full mb-4">
						<svg
							class="w-8 h-8 text-white"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24">
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
						</svg>
					</div>
					<h1 class="text-3xl font-bold text-gray-800 mb-2">
						Portal de Imigração
					</h1>
					<p class="text-gray-600">
						Acesse sua conta para ver o status do seu processo!
					</p>
				</div>

				<div class="space-y-6">
					<div>
						<label class="block text-sm font-medium text-gray-700 mb-2"
							>Email</label
						>
						<input
							type="email"
							id="email"
							class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand focus:border-transparent"
							placeholder="Digite seu email" />
					</div>

					<div>
						<label class="block text-sm font-medium text-gray-700 mb-2"
							>Senha</label
						>
						<input
							type="password"
							id="password"
							class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand focus:border-transparent"
							placeholder="Digite sua senha" />
					</div>

					<div
						id="errorMessage"
						class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center gap-2">
						<svg
							class="w-5 h-5"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24">
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
						</svg>
						<span id="errorText"></span>
					</div>

					<button
						onclick="handleLogin()"
						id="loginBtn"
						class="w-full bg-brand text-white py-3 rounded-lg font-semibold hover:bg-red-800 transition-colors">
						Entrar
					</button>
				</div>

				<div class="mt-6 p-4 bg-gray-50 rounded-lg">
					<p class="text-sm text-gray-600 font-semibold mb-2">
						Configure seu Supabase:
					</p>
					<p class="text-xs text-gray-500">
						Adicione suas credenciais no código JavaScript
					</p>
				</div>
			</div>
		</div>

		<!-- Dashboard Screen -->
		<div id="dashboardScreen" class="hidden min-h-screen">
			<!-- Overlay -->
			<div
				id="overlay"
				class="fixed inset-0 bg-gray-800/20 hidden opacity-0 transition-opacity duration-300 z-20"></div>

			<!-- Mobile Header -->
			<header
				class="md:hidden bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10">
				<div class="flex items-center justify-between px-4 py-3">
					<button
						id="menuBtn"
						class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
						<svg
							class="w-6 h-6 text-gray-700"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24">
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M4 6h16M4 12h16M4 18h16" />
						</svg>
					</button>
					<h1 class="text-lg font-bold text-gray-900">Portal de Imigração</h1>
					<div class="w-10"></div>
				</div>
			</header>

			<div class="flex min-h-screen">
				<!-- Sidebar -->
				<aside
					id="sidebar"
					class="fixed md:static top-0 left-0 w-72 h-screen bg-white border-r border-gray-200 flex flex-col -translate-x-full md:translate-x-0 transition-transform duration-300 z-30">
					<!-- Logo/Header -->
					<div class="p-6 border-b border-gray-200">
						<div class="flex items-center gap-3 mb-4">
							<div
								class="w-12 h-12 bg-brand rounded-lg flex items-center justify-center flex-shrink-0">
								<svg
									class="w-6 h-6 text-white"
									fill="none"
									stroke="currentColor"
									viewBox="0 0 24 24">
									<path
										stroke-linecap="round"
										stroke-linejoin="round"
										stroke-width="2"
										d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
								</svg>
							</div>
							<div class="min-w-0">
								<h2
									class="font-bold text-gray-900 truncate"
									id="sidebarName"></h2>
								<p
									class="text-xs text-gray-500 truncate"
									id="sidebarProcess"></p>
							</div>
						</div>

						<!-- Status Badge -->
						<div
							id="sidebarStatusBadge"
							class="px-3 py-1.5 rounded-full text-sm font-semibold text-center"></div>
					</div>

					<!-- Navigation -->
					<nav class="flex-1 p-4 space-y-1 overflow-y-auto">
						<button
							onclick="switchTab('overview')"
							id="navOverview"
							class="w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-blue-100 text-brand font-semibold">
							<svg
								class="w-5 h-5"
								fill="none"
								stroke="currentColor"
								viewBox="0 0 24 24">
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									stroke-width="2"
									d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
							</svg>
							Visão Geral
						</button>
						<button
							onclick="switchTab('documents')"
							id="navDocuments"
							class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition-colors">
							<svg
								class="w-5 h-5"
								fill="none"
								stroke="currentColor"
								viewBox="0 0 24 24">
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									stroke-width="2"
									d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
							</svg>
							Documentos
						</button>
						<button
							onclick="switchTab('history')"
							id="navHistory"
							class="w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition-colors">
							<svg
								class="w-5 h-5"
								fill="none"
								stroke="currentColor"
								viewBox="0 0 24 24">
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									stroke-width="2"
									d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
							</svg>
							Histórico
						</button>
					</nav>

					<!-- Logout Button -->
					<div class="p-4 border-t border-gray-200">
						<button
							onclick="handleLogout()"
							class="w-full flex items-center justify-center gap-2 px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors font-medium">
							<svg
								class="w-5 h-5"
								fill="none"
								stroke="currentColor"
								viewBox="0 0 24 24">
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									stroke-width="2"
									d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
							</svg>
							Sair
						</button>
					</div>
				</aside>

				<!-- Main Content -->
				<main class="flex-1 overflow-y-auto w-full">
					<div class="max-w-6xl mx-auto p-4 md:p-8">
						<!-- Status Card -->
						<div
							class="bg-white rounded-2xl shadow-lg p-6 md:p-8 mb-6 md:mb-8 fade-in">
							<div class="flex items-start justify-between mb-6">
								<div>
									<h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">
										Status do Processo
									</h1>
									<p
										class="text-base md:text-lg text-gray-600"
										id="currentStage"></p>
								</div>
							</div>

							<!-- Progress Bar -->
							<div class="mb-6 md:mb-8">
								<div class="flex justify-between text-sm text-gray-600 mb-3">
									<span class="font-medium">Progresso</span>
									<span
										class="font-bold text-brand"
										id="progressPercent"></span>
								</div>
								<div
									class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
									<div
										id="progressBar"
										class="progress-bar h-4 rounded-full"></div>
								</div>
							</div>

							<!-- Dates -->
							<div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
								<div class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl">
									<div
										class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
										<svg
											class="w-6 h-6 text-brand"
											fill="none"
											stroke="currentColor"
											viewBox="0 0 24 24">
											<path
												stroke-linecap="round"
												stroke-linejoin="round"
												stroke-width="2"
												d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
										</svg>
									</div>
									<div>
										<p class="text-sm text-gray-500 mb-1">Data de Início</p>
										<p
											class="font-bold text-gray-900 text-base md:text-lg"
											id="startDate"></p>
									</div>
								</div>
								<div class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl">
									<div
										class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
										<svg
											class="w-6 h-6 text-green-600"
											fill="none"
											stroke="currentColor"
											viewBox="0 0 24 24">
											<path
												stroke-linecap="round"
												stroke-linejoin="round"
												stroke-width="2"
												d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
										</svg>
									</div>
									<div>
										<p class="text-sm text-gray-500 mb-1">
											Previsão de Conclusão
										</p>
										<p
											class="font-bold text-gray-900 text-base md:text-lg"
											id="endDate"></p>
									</div>
								</div>
							</div>
						</div>

						<!-- Tab Content -->
						<div>
							<!-- Overview Tab -->
							<div id="overviewContent" class="space-y-6">
								<div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
									<h3 class="text-xl font-bold text-gray-900 mb-6">
										Informações de Contato
									</h3>
									<div class="grid grid-cols-1 gap-4 md:gap-6">
										<div
											class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl">
											<div
												class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
												<svg
													class="w-5 h-5 text-blue-600"
													fill="none"
													stroke="currentColor"
													viewBox="0 0 24 24">
													<path
														stroke-linecap="round"
														stroke-linejoin="round"
														stroke-width="2"
														d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
												</svg>
											</div>
											<div class="min-w-0">
												<p class="text-xs text-gray-500 mb-1">Email</p>
												<p
													class="font-semibold text-gray-900 truncate"
													id="clientEmail"></p>
											</div>
										</div>
										<div
											class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl">
											<div
												class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
												<svg
													class="w-5 h-5 text-green-600"
													fill="none"
													stroke="currentColor"
													viewBox="0 0 24 24">
													<path
														stroke-linecap="round"
														stroke-linejoin="round"
														stroke-width="2"
														d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
												</svg>
											</div>
											<div class="min-w-0">
												<p class="text-xs text-gray-500 mb-1">Telefone</p>
												<p
													class="font-semibold text-gray-900"
													id="clientPhone"></p>
											</div>
										</div>
										<div
											class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl">
											<div
												class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
												<svg
													class="w-5 h-5 text-purple-600"
													fill="none"
													stroke="currentColor"
													viewBox="0 0 24 24">
													<path
														stroke-linecap="round"
														stroke-linejoin="round"
														stroke-width="2"
														d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
												</svg>
											</div>
											<div class="min-w-0">
												<p class="text-xs text-gray-500 mb-1">Endereço</p>
												<p
													class="font-semibold text-gray-900 truncate"
													id="clientAddress"></p>
											</div>
										</div>
									</div>
								</div>

								<div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
									<h3 class="text-xl font-bold text-gray-900 mb-6">
										Próximos Passos
									</h3>
									<div id="nextSteps" class="space-y-3"></div>
								</div>
							</div>

							<!-- Documents Tab -->
							<div id="documentsContent" class="hidden space-y-6"></div>

							<!-- History Tab -->
							<div id="historyContent" class="hidden">
								<div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
									<h3 class="text-xl font-bold text-gray-900 mb-6">
										Histórico do Processo
									</h3>
									<div id="historyTimeline" class="space-y-4"></div>
								</div>
							</div>
						</div>
					</div>
				</main>
			</div>
		</div>

		<script>
			// ========================================
			// SUPABASE CONFIGURATION
			// ========================================
			const SUPABASE_URL = "https://lqyvatogkwndlpsetwie.supabase.co";
			const SUPABASE_ANON_KEY =
				"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxeXZhdG9na3duZGxwc2V0d2llIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5MTkwODAsImV4cCI6MjA3NzQ5NTA4MH0.-OOYSpIt9YcLiMt2RTlfY7KUQWHMnELf1OczPpb-2II";

			const supabase = window.supabase.createClient(
				SUPABASE_URL,
				SUPABASE_ANON_KEY
			);

			let currentClient = null;
			let currentUser = null;

			// ========================================
			// MOBILE MENU FUNCTIONS
			// ========================================
			function openDrawer() {
				const sidebar = document.getElementById("sidebar");
				const overlay = document.getElementById("overlay");

				sidebar.classList.remove("-translate-x-full");
				sidebar.classList.add("translate-x-0");

				overlay.classList.remove("hidden");
				setTimeout(() => overlay.classList.add("opacity-100"), 10);
			}

			function closeDrawer() {
				const sidebar = document.getElementById("sidebar");
				const overlay = document.getElementById("overlay");

				sidebar.classList.remove("translate-x-0");
				sidebar.classList.add("-translate-x-full");

				overlay.classList.remove("opacity-100");
				setTimeout(() => overlay.classList.add("hidden"), 300);
			}

			// ========================================
			// AUTHENTICATION FUNCTIONS
			// ========================================
			async function handleLogin() {
				const email = document.getElementById("email").value;
				const password = document.getElementById("password").value;
				const errorMessage = document.getElementById("errorMessage");
				const errorText = document.getElementById("errorText");
				const loginBtn = document.getElementById("loginBtn");

				if (!email || !password) {
					errorText.textContent = "Por favor, preencha todos os campos";
					errorMessage.classList.remove("hidden");
					return;
				}

				loginBtn.disabled = true;
				loginBtn.textContent = "Entrando...";

				try {
					const { data: authData, error: authError } =
						await supabase.auth.signInWithPassword({
							email: email,
							password: password,
						});

					if (authError) throw authError;

					currentUser = authData.user;

					const { data: clientData, error: clientError } = await supabase
						.from("clientes")
						.select("*")
						.eq("user_id", currentUser.id)
						.single();

					if (clientError) throw new Error("Dados do cliente não encontrados");

					currentClient = clientData;
					errorMessage.classList.add("hidden");
					await showDashboard();
				} catch (error) {
					console.error("Login error:", error);
					errorText.textContent = error.message || "Erro ao fazer login";
					errorMessage.classList.remove("hidden");
				} finally {
					loginBtn.disabled = false;
					loginBtn.textContent = "Entrar";
				}
			}

			async function handleLogout() {
				await supabase.auth.signOut();
				currentClient = null;
				currentUser = null;
				document.getElementById("email").value = "";
				document.getElementById("password").value = "";
				document.getElementById("loginScreen").classList.remove("hidden");
				document.getElementById("dashboardScreen").classList.add("hidden");
			}

			// ========================================
			// DASHBOARD FUNCTIONS
			// ========================================
			async function showDashboard() {
				document.getElementById("loginScreen").classList.add("hidden");
				document.getElementById("dashboardScreen").classList.remove("hidden");

				document.getElementById("sidebarName").textContent = currentClient.nome;
				document.getElementById("sidebarProcess").textContent =
					currentClient.processo;
				document.getElementById("currentStage").textContent =
					currentClient.etapa;
				document.getElementById(
					"progressPercent"
				).textContent = `${currentClient.progresso}%`;
				document.getElementById("startDate").textContent = formatDate(
					currentClient.data_inicio
				);
				document.getElementById("endDate").textContent = formatDate(
					currentClient.previsao_conclusao
				);

				const statusBadge = document.getElementById("sidebarStatusBadge");
				const progressBar = document.getElementById("progressBar");

				let statusText = "";
				let statusColor = "";
				let progressColor = "";

				if (currentClient.status === "concluido") {
					statusText = "Concluído";
					statusColor = "bg-green-500 text-white";
					progressColor = "bg-green-500";
				} else if (currentClient.status === "em_progresso") {
					statusText = "Em Progresso";
					statusColor = "bg-blue-500 text-white";
					progressColor = "bg-blue-500";
				} else {
					statusText = "Pendente";
					statusColor = "bg-yellow-500 text-white";
					progressColor = "bg-yellow-500";
				}

				statusBadge.textContent = statusText;
				statusBadge.className = `px-3 py-1.5 rounded-full text-sm font-semibold text-center ${statusColor}`;
				progressBar.className = `progress-bar h-4 rounded-full ${progressColor}`;
				progressBar.style.width = `${currentClient.progresso}%`;

				document.getElementById("clientEmail").textContent =
					currentClient.email;
				document.getElementById("clientPhone").textContent =
					currentClient.telefone;
				document.getElementById("clientAddress").textContent =
					currentClient.endereco || currentClient.telefone;

				await loadNextSteps();
				await loadDocuments();
				await loadHistory();
			}

			async function loadNextSteps() {
				try {
					const { data, error } = await supabase
						.from("proximos_passos")
						.select("*")
						.eq("cliente_id", currentClient.id)
						.order("ordem", { ascending: true });

					if (error) throw error;

					const nextSteps = document.getElementById("nextSteps");
					nextSteps.innerHTML = "";

					if (data && data.length > 0) {
						data.forEach((passo, index) => {
							nextSteps.innerHTML += `
                            <div class="flex items-start gap-4 p-4 bg-red-50 rounded-xl border-l-4 border-brand">
                                <div class="w-8 h-8 bg-brand text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0">
                                    ${index + 1}
                                </div>
                                <p class="text-gray-700 font-medium pt-1">${
																	passo.descricao
																}</p>
                            </div>
                        `;
						});
					} else {
						nextSteps.innerHTML =
							'<p class="text-gray-500 text-center py-8">Nenhum próximo passo pendente.</p>';
					}
				} catch (error) {
					console.error("Error loading next steps:", error);
				}
			}

			async function loadDocuments() {
				try {
					const { data, error } = await supabase
						.from("documentos")
						.select("*")
						.eq("cliente_id", currentClient.id)
						.order("nome", { ascending: true });

					if (error) throw error;

					const documentsContent = document.getElementById("documentsContent");
					documentsContent.innerHTML = "";

					if (data && data.length > 0) {
						const sectionDiv = document.createElement("div");
						sectionDiv.className =
							"section-card bg-white rounded-2xl shadow-lg overflow-hidden";

						let docsHTML = "";
						data.forEach((doc, index) => {
							const statusInfo = getDocStatusInfo(doc.status);
							const hasDescription =
								doc.descricao && doc.descricao.trim() !== "";
							const docId = `doc-${index}`;

							docsHTML += `
                            <div class="border-b border-gray-100 last:border-b-0">
                                <div class="flex items-center justify-between p-4 hover:bg-gray-50 transition-colors ${
																	hasDescription ? "cursor-pointer" : ""
																}" ${
								hasDescription ? `onclick="toggleDocDetails('${docId}')"` : ""
							}>
                                    <div class="flex items-center gap-3 flex-1 min-w-0">
                                        <svg class="w-5 h-5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                        </svg>
                                        <span class="font-medium text-gray-900 truncate">${
																					doc.nome
																				}</span>
                                    </div>
                                    <div class="flex items-center gap-3 flex-shrink-0">
                                        <div class="flex items-center gap-2 px-3 py-1.5 rounded-full ${
																					statusInfo.color
																				}">
                                            ${statusInfo.icon}
                                            <span class="text-xs font-semibold">${
																							statusInfo.text
																						}</span>
                                        </div>
                                        ${
																					hasDescription
																						? `
                                        <svg id="chevron-${docId}" class="w-5 h-5 text-gray-400 transition-transform flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                        </svg>
                                        `
																						: ""
																				}
                                    </div>
                                </div>
                                ${
																	hasDescription
																		? `
                                <div id="${docId}" class="hidden px-4 pb-4 bg-gray-50">
                                    <div class="pt-3 text-gray-600 text-sm leading-relaxed">
                                        ${doc.descricao}
                                    </div>
                                </div>
                                `
																		: ""
																}
                            </div>
                        `;
						});

						sectionDiv.innerHTML = `
                        <div class="bg-brand px-6 py-4">
                            <h2 class="text-xl font-bold text-white">Documentos</h2>
                        </div>
                        <div>
                            ${docsHTML}
                        </div>
                    `;

						documentsContent.appendChild(sectionDiv);
					} else {
						documentsContent.innerHTML =
							'<div class="bg-white rounded-2xl shadow-lg p-12 text-center"><p class="text-gray-500">Nenhum documento cadastrado.</p></div>';
					}
				} catch (error) {
					console.error("Error loading documents:", error);
				}
			}

			function toggleDocDetails(docId) {
				const detailsDiv = document.getElementById(docId);
				const chevron = document.getElementById(`chevron-${docId}`);

				if (detailsDiv) {
					detailsDiv.classList.toggle("hidden");
					if (chevron) {
						chevron.classList.toggle("rotate-180");
					}
				}
			}

			async function loadHistory() {
				try {
					const { data, error } = await supabase
						.from("historico")
						.select("*")
						.eq("cliente_id", currentClient.id)
						.order("data", { ascending: false });

					if (error) throw error;

					const historyTimeline = document.getElementById("historyTimeline");
					historyTimeline.innerHTML = "";

					if (data && data.length > 0) {
						data.forEach((item, index) => {
							const isLast = index === data.length - 1;
							historyTimeline.innerHTML += `
                            <div class="flex gap-4">
                                <div class="flex flex-col items-center">
                                    <div class="w-4 h-4 bg-brand rounded-full ring-4 ring-red-100"></div>
                                    ${
																			!isLast
																				? '<div class="w-0.5 flex-1 bg-gray-200 my-1"></div>'
																				: ""
																		}
                                </div>
                                <div class="pb-8 flex-1">
                                    <p class="text-sm text-gray-500 mb-1">${formatDate(
																			item.data
																		)}</p>
                                    <p class="text-gray-900 font-semibold text-lg">${
																			item.evento
																		}</p>
                                </div>
                            </div>
                        `;
						});
					} else {
						historyTimeline.innerHTML =
							'<p class="text-gray-500 text-center py-8">Nenhum histórico disponível.</p>';
					}
				} catch (error) {
					console.error("Error loading history:", error);
				}
			}

			// ========================================
			// HELPER FUNCTIONS
			// ========================================
			function getDocStatusInfo(status) {
				const icons = {
					aprovado: `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>`,
					em_analise: `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>`,
					pendente: `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>`,
				};

				const colors = {
					aprovado: "text-green-700 bg-green-50",
					em_analise: "text-blue-700 bg-blue-50",
					pendente: "text-yellow-700 bg-yellow-50",
				};

				const texts = {
					aprovado: "Aprovado",
					em_analise: "Em Análise",
					pendente: "Pendente",
				};

				return {
					icon: icons[status] || icons.pendente,
					color: colors[status] || colors.pendente,
					text: texts[status] || "Desconhecido",
				};
			}

			function formatDate(dateString) {
				if (!dateString) return "N/A";
				const date = new Date(dateString);
				return date.toLocaleDateString("pt-BR");
			}

			function switchTab(tab) {
				const tabs = {
					overview: { content: "overviewContent", nav: "navOverview" },
					documents: { content: "documentsContent", nav: "navDocuments" },
					history: { content: "historyContent", nav: "navHistory" },
				};

				Object.entries(tabs).forEach(([key, ids]) => {
					const btn = document.getElementById(ids.nav);
					const content = document.getElementById(ids.content);

					if (key === tab) {
						btn.className =
							"w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-red-50 text-brand font-semibold";
						content.classList.remove("hidden");
					} else {
						btn.className =
							"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition-colors";
						content.classList.add("hidden");
					}
				});

				// Close drawer on mobile when switching tabs
				if (window.innerWidth < 768) {
					closeDrawer();
				}
			}

			// ========================================
			// EVENT LISTENERS
			// ========================================
			document
				.getElementById("password")
				.addEventListener("keypress", function (e) {
					if (e.key === "Enter") {
						handleLogin();
					}
				});

			// Menu button click
			document
				.getElementById("menuBtn")
				.addEventListener("click", function (e) {
					e.stopPropagation();
					const sidebar = document.getElementById("sidebar");
					if (sidebar.classList.contains("-translate-x-full")) {
						openDrawer();
					} else {
						closeDrawer();
					}
				});

			// Overlay click
			document.getElementById("overlay").addEventListener("click", function () {
				closeDrawer();
			});

			// Check for existing session on load
			supabase.auth.getSession().then(({ data: { session } }) => {
				if (session) {
					currentUser = session.user;
					supabase
						.from("clientes")
						.select("*")
						.eq("user_id", currentUser.id)
						.single()
						.then(({ data }) => {
							if (data) {
								currentClient = data;
								showDashboard();
							}
						});
				}
			});
		</script>
	</body>
</html>
